# GOKZBOT 插件开发计划

本文档用于规划和追踪 GOKZBOT 插件的功能开发。

## 1. 核心目标

开发一个功能全面的 QQ 机器人插件，用于查询 GOKZ（KZ 模式）相关的玩家数据和服务器信息。

## 2. 数据库设计

使用 pg数据库存储用户信息相关数据。
数据库现在还未用户创建表你可以根据自己需求创建表。
数据库ip:103.120.89.225 数据库名qqbot用户名qqbot密码qqbotqqbot
## 3. 功能指令

---

### 3.1. 绑定账号 (`/bind`) - [待完善]

- **指令:** `/bind <steamid>` 或 `/bind <steamid> -u kzt` 或 `/bind <steamid> -u skz` 或 `/bind <steamid> -u vnl`
- **描述:** 将用户的 QQ 账号与一个 Steam 账号绑定。支持 SteamID, SteamID3, SteamID64, 或自定义 URL 作为输入。
- **流程:**
  1. 用户发送 `/bind <steamid>`。
  2. 插件向 `https://steamid.io/lookup/<steamid>` 发送请求。
  3. 如果请求失败或找不到用户，回复错误信息。
  4. 如果成功，解析页面获取用户的 `SteamID64` 和 `Steam昵称`。
  5. 使用代码获取用户的QQ账号，将数据保存在用户信息数据库中，
    - 如果数据库中该QQ账号已经绑定过则提示用户：您已经绑定过steamid为：xxx的账号！
    - 如果该用户没有绑定过，则进行绑定，并将用户信息保存在用户数据库中。
  6. 回复用户绑定/更新成功的信息。
  7. 如果用户使用-u参数则默认使用对应模式，如果不使用-u参数则默认使用kzt模式。
- **成功回复:** `成功绑定 Steam 账户: [昵称] ([SteamID64])` 或 `已经绑定过: [昵称] ([SteamID64])`
- **失败回复:** `用法: /bind <steamid>` 或 `无法找到 SteamID '[输入]' 的信息，请检查输入是否正确。`

---

### 3.2. 查询信息 (`/info`) - [待完善]

- **指令:** `/info` 或 `/info @某人`
- **描述:** 查询自己或被 @ 用户的绑定信息。
- **流程:**
  1. 如果没有@任何人，目标为发送者自己。如果@了某人，目标为被@的人。
  2. 根据目标的 `qq_id` 在数据库中查询。
  3. 如果未找到记录，提示用户未绑定。
  4. 如果找到，格式化并展示信息。
- **成功回复:**
  ```
  Steam 名称: [昵称]
  SteamID64: [SteamID64]
  绑定时间: [YYYY-MM-DD HH:MM:SS]
  ```
- **失败回复:** `你还没有绑定 SteamID。请使用 /bind <steamid> 进行绑定。` 或 `[被@的人的昵称] 还没有绑定 SteamID。`

---

## 4. 查询kz数据 (`/kz`) - [待开发]

- **指令:** `/kz` 或 `/kz @某人`
- **需要的网站:**  https://kzgo.eu/ https://vnl.kz/

    1. 用户使用/kz命令进行kz数据查询。数据查询网站 https://kzgo.eu/
        - 游戏分为kzt模式skz模式vnl模式。
        - 例如查询游戏模式为kzt，steamid为STEAM_1:0:496876096的用户使用连接https://kzgo.eu/players/ STEAM_1:0:496876096?kzt  该网站可用于查询skz模式和kzt模式。
        - vnl模式用户使用 https://vnl.kz/ 网站，例如查询玩家steamid64为76561199067723921的玩家使用链接https://vnl.kz/#/stats/76561199067723921 
        - 使用/kz命令之后代码查询到玩家kz数据进行绘画，以图片形式显示玩家数据例如Screenshot_2025-11-02-23-59-40-85_9d26c6446fd7bb8.jpg该图片样式，其中有玩家头像，玩家等级，玩家名称，玩家数据。

    2. vnl中使用https://kztimerglobal.com/api/v2.0/records/top?steamid64=76561199295538824&stage=0&modes_list_string=kz_vanilla&limit=10000&has_teleports=true 的链接进行查询steamid64为76561199295538824的玩家，该链接中能够获取玩家完成tp地图的分数，玩家的总分是该链接数据中每个地图的points全部想加，链接每块数据中的points是完成该地图分数，map_id是地图的标识，将map_id与数据库qqbot中的表vnlmaptier中的id对比出当前地图的tptier等级，用作后面绘制/kz的图片.



### 4.1. 查询玩家最近kz数据 (`/pb`) - [待开发]

- **指令:** `/pb` 或 `/pb @某人`
- **描述:** 查询玩家在 GOKZ 全球服的最近完成地图数据。
- **需要的网站:**  https://kzgo.eu/ https://vnl.kz/
- **展示数据:** (请在此处填写您希望看到的数据，例如：)
  - 玩家名称
  - 玩家steamid
  - 最近完成地图名称
  - 最近完成的地图图片
  - 最近完成地图时间
  - 最近完成地图通关时间
  - 最近完成地图分数

- **流程:** 
    1. 玩家输入/pb命令之后进行查询
- **回复格式:** (请描述您期望的回复样式)







### 4.1. 查询玩家全局数据 (`/kzstats`) - [待开发]

- **指令:** `/kzstats` 或 `/kzstats @某人`
- **描述:** 查询玩家在 GOKZ 全球服的统计数据。
- **需要调用的API:** (待定, 例如 GOKZ Global API)
- **展示数据:** (请在此处填写您希望看到的数据，例如：)
  - 总积分
  - 全球排名
  - 平均完赛时间
  - 最近完成的地图
  - ...
- **回复格式:** (请描述您期望的回复样式)

---
